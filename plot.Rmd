```{r}
# Packages
pacman::p_load(tidyverse, sp, leaflet)

# Get data
data <- openxlsx::read.xlsx("data/parks.xlsx")

# Logos
logo_url <- list.files("logos", full.names = T)

# Split coordinate column
data <- data %>%
  tidyr::separate(Coordinates, c('Lat', 'Long'), sep = ", ") %>%
  mutate(
    Lat = as.numeric(Lat), Long = as.numeric(Long),
    Logo_url = logo_url
  )
```


**Tilanne:** `r (data %>% filter(Visit == "Joo") %>% nrow / nrow(data)) %>% scales::percent(., suffix = " %")` puistoista käyty (`r nrow(data %>% filter(Visit == "Joo"))` / `r nrow(data)`)! 

### Kartta

```{r include=FALSE}
# GPX files
# https://medium.com/@mark.reuter/parsing-gps-gpx-files-with-r-21ea0a694da8
routes <- list.files("data/gpx", recursive = T, full.names = T)

gpx <- list()
for (i in 1:length(routes)) {
  cat(paste0(routes[i], "  "))
  gpx[[i]] <- xml2::read_html(routes[i]) %>% # Parse
    xml2::xml_find_all("//trkpt") %>% # The lat and long data
    xml2::xml_attrs() %>% bind_rows() %>%
    mutate(route = i)
}

gpxdf <- bind_rows(gpx) %>%
  mutate(lat = as.numeric(lat), lon = as.numeric(lon))
# head(gpxdf)

```


```{r}
# Visited icons
visited <- data %>% filter(Visit == "Joo")
visited_icons <- icons(
  iconUrl = visited$Logo_url,
  iconWidth = 40, iconHeight = 30,
  iconAnchorX = 0, iconAnchorY = 0
)

# Not yet
notyet <- data %>% filter(Visit != "Joo")
notyet_icons <- icons(
  iconUrl = "help-circle.svg",
  iconWidth = 20, iconHeight = 20,
  iconAnchorX = 0, iconAnchorY = 0
)

# Plot
basemap <- data %>%
  leaflet() %>%
  addTiles() %>%
  addMarkers(
    data = visited, ~Long, ~Lat,
    label = paste0(visited$Park_short, "\n", visited$Dates),
    icon = visited_icons
  ) %>%
  addMarkers(
    data = notyet, ~Long, ~Lat,
    label = notyet$Park_short,
    icon = notyet_icons
  )

# Add gpx routes
for (i in 1:length(routes)) {
  basemap <- basemap %>%
    addPolylines(
      data = gpxdf %>% filter(route == i),
      lat = ~lat,
      lng = ~lon,
      color = "#CD2626",
      opacity = 0.8,
      weight = 3
    )
}
basemap
```

Käydyt puistot merkitty logolla ja käymättömät kysymysmerkillä. 


```{r eval=FALSE, include=FALSE}
data %>% select(
  Kansallispuisto = Park_short, Maakunta = Region, Kunta = Municipality,
  `Kävijöitä (2023)` = Visitors_2023, `Pinta-ala` = Area
) %>%
  reactable::reactable(defaultPageSize = 5)


```


### Lähteet

Kartta on tehty käyttäen R-paketteja `sp` ja `leaflet`.

Koordinaatit osoitteesta: kartta.com/muut-kartat/suomen-kansallispuistot/.




